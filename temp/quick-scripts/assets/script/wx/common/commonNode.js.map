{"version":3,"sources":["commonNode.js"],"names":["self","TAG","commonNode","cc","Class","statics","instance","getInstance","scene","director","getScene","node","getChildByTag","tagSize","getContentSize","console","log","addChild","_commonNode","_size","scaleX","width","scaleY","height","_scale","setScale","adapterHeight","setPosition","ctor","addNode","loader","loadRes","Prefab","err","prefab","instantiate","canvas","find","name","widget","isNeedSetContent","_widget","adapterHeightContent","_widgetSize","setContentSize"],"mappings":"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","file":"commonNode.js","sourceRoot":"../../../../../../assets/script/wx/common","sourcesContent":["var self = null;\r\nvar TAG = 2100;\r\nvar commonNode = cc.Class({\r\n    statics: {\r\n        instance: null,\r\n        getInstance: function () {\r\n            if (commonNode.instance == null) {\r\n                commonNode.instance = new commonNode();\r\n            }else{\r\n                let scene = cc.director.getScene();\r\n                let node = scene.getChildByTag(TAG);\r\n                if(!!!node){\r\n                    let tagSize = scene.getContentSize();\r\n                    console.log(\"addNode\",scene,tagSize);\r\n                    scene.addChild(self._commonNode,1,TAG);\r\n        \r\n                    var _size = self._commonNode.getContentSize();\r\n                    var scaleX = tagSize.width/_size.width;\r\n                    var scaleY = tagSize.height/_size.height;\r\n                    if(scaleX || scaleY){\r\n                        var _scale = scaleX;\r\n                        if(scaleX > scaleY){\r\n                            _scale = scaleY;  \r\n                        }\r\n                        self._commonNode.setScale(scaleX,scaleY);\r\n                        self.adapterHeight(\"mask\",self._commonNode,scaleX,scaleY,_scale);                  \r\n                    }         \r\n                    self._commonNode.setPosition(_size.width/2,_size.height/2)       \r\n                }\r\n            }\r\n            return commonNode.instance;\r\n        }\r\n    },\r\n    ctor(){\r\n        self = this;\r\n        self.addNode();\r\n        \r\n    },\r\n    addNode(){\r\n        cc.loader.loadRes(\"wx/common/commonNode\",cc.Prefab,function(err,prefab){\r\n            self._commonNode = cc.instantiate( prefab ) ;\r\n            console.log(self._commonNode);\r\n            //self._js = self._commonNode.getComponent(\"commonLayer\");\r\n            let scene = cc.director.getScene();\r\n            let canvas = cc.find('Canvas');\r\n\r\n            let tagSize = canvas.getContentSize();\r\n            console.log(\"addNode\",scene,tagSize);\r\n            scene.addChild(self._commonNode,1,TAG);\r\n\r\n            var _size = self._commonNode.getContentSize();\r\n            var scaleX = tagSize.width/_size.width;\r\n            var scaleY = tagSize.height/_size.height;\r\n            if(scaleX || scaleY){\r\n                var _scale = scaleX;\r\n                if(scaleX > scaleY){\r\n                    _scale = scaleY;  \r\n                }\r\n                self._commonNode.setScale(scaleX,scaleY);\r\n                self.adapterHeight(\"mask\",self._commonNode,scaleX,scaleY,_scale);                  \r\n            }         \r\n            self._commonNode.setPosition(_size.width/2,_size.height/2)\r\n        })\r\n    },\r\n    adapterHeight : function(name,widget,scaleX,scaleY,_scale,isNeedSetContent = false){\r\n        var _widget = cc.find(name,widget);\r\n        if(_widget){\r\n            _widget.setScale(1/scaleX * _scale,1/scaleY *_scale);\r\n            if(isNeedSetContent){\r\n                self.adapterHeightContent(name,widget,scaleX,scaleY,_scale);\r\n                self.adapterHeightContent(\"viewport\",_widget,scaleX,scaleY,_scale);             \r\n            }\r\n        }       \r\n    },\r\n    adapterHeightContent : function(name,widget,scaleX,scaleY,_scale){\r\n        var _widget = cc.find(name,widget);\r\n        if(_widget){\r\n            var _widgetSize = _widget.getContentSize();\r\n            _widgetSize.height = _widgetSize.height*scaleY/_scale;\r\n            _widget.setContentSize(_widgetSize.width,_widgetSize.height);\r\n        }                  \r\n    },\r\n});\r\n"]}