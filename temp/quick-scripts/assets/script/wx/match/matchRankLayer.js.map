{"version":3,"sources":["matchRankLayer.js"],"names":["util","require","match","self","cc","Class","extends","Component","properties","rankItem","Prefab","withdrawWidget","onLoad","challengePanel","find","node","gameIcon","getComponent","Sprite","limitScore","Label","endTimeDesc","challengeBtn","challengeBtnLb","on","onChallengeBtnClick","withdraw","onWithdrawClick","rankPanel","scrollView","ScrollView","content","closeBtn","onCloseBtnClick","bestThreeWidgets","Array","i","index","withdrawView","instantiate","addChild","active","allMoneyLb","matchState","moneyState","start","init","matchData","rankData","console","log","matchId","_id","initChallengeView","initRankView","string","limitscore","parseDate","endtime","interactable","queryMyMatch","success","res","matchstate","moneystate","updateChallengeView","fail","bestList","removeAllChildren","value","shift","push","initBestThree","initScrollView","list","data","updateBestData","widget","name","grade","image","score","texture","portrait","split","loader","load","url","type","err","spriteFrame","SpriteFrame","setTexture","length","item","createRankItem","scrollToTop","getCurMatchMoney","wx","showToast","title","duration","enterMatch","getAllMoney","allmoney","time","datetime","Date","setTime","month","getMonth","date","getDate","hour","getHours","minute","getMinutes"],"mappings":"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","file":"matchRankLayer.js","sourceRoot":"../../../../../../assets/script/wx/match","sourcesContent":["var util = require('../utils/util');\r\nvar match = require('./match');\r\nvar self = null;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        rankItem: cc.Prefab,\r\n        withdrawWidget: cc.Prefab\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        self = this;\r\n\r\n        // match 界面相关元素设置\r\n        self.challengePanel = cc.find('challengePanel', self.node);\r\n        self.gameIcon = cc.find('gameIcon/mask/image', self.challengePanel).getComponent(cc.Sprite);\r\n        self.limitScore = cc.find('targetLabel/score', self.challengePanel).getComponent(cc.Label);\r\n        self.endTimeDesc = cc.find('timeLimitDesc', self.challengePanel).getComponent(cc.Label);\r\n\r\n        self.challengeBtn = cc.find('challengeBtn', self.challengePanel);\r\n        self.challengeBtnLb = cc.find('desc', self.challengeBtn).getComponent(cc.Label);\r\n        self.challengeBtn.on('click', self.onChallengeBtnClick, self);\r\n\r\n        self.withdraw = cc.find('withdraw', self.challengePanel);\r\n        self.withdraw.on('click', self.onWithdrawClick, self);\r\n\r\n        // rank 相关界面元素设置\r\n        self.rankPanel = cc.find('rankPanel', self.node);\r\n        self.scrollView = cc.find('rankScroll', self.rankPanel).getComponent(cc.ScrollView);\r\n        self.content = self.scrollView.content;\r\n\r\n        self.closeBtn = cc.find('closeBtn', self.node);\r\n        self.closeBtn.on('click', self.onCloseBtnClick, self);\r\n\r\n        self.bestThreeWidgets = new Array();\r\n        for (var i = 0; i < 3; i++) {\r\n            var index = i + 1;\r\n            self.bestThreeWidgets[i] = cc.find('rank_' + index, self.rankPanel);\r\n        }\r\n\r\n        // 提现界面设置\r\n        self.withdrawView = cc.instantiate(self.withdrawWidget);\r\n        self.node.addChild(self.withdrawView);\r\n        self.withdrawView.active = false;\r\n\r\n        self.allMoneyLb = cc.find('money', self.withdrawView).getComponent(cc.Label);\r\n        cc.find('closeBtn', self.withdrawView).on('click', function () {\r\n            self.withdrawView.active = false;\r\n        });\r\n\r\n        // 状态设置\r\n        self.matchState = 1;    // 0: 比赛过期或不存在, 1: 未参加比赛, 2: 已参加比赛\r\n        self.moneyState = 0;    // 0: 未达到条件, 1: 已达到条件但未领取, 2: 已领取\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    init (matchData, rankData) {\r\n        console.log('match rank layer inited ..........');\r\n        console.log('match data:', matchData);\r\n        console.log('rank data:', rankData);\r\n\r\n        self.matchId = matchData._id;\r\n\r\n        self.initChallengeView(matchData);\r\n        self.initRankView(rankData);\r\n    },\r\n\r\n    initChallengeView (matchData) {\r\n        self.limitScore.string = matchData.limitscore;\r\n        self.endTimeDesc.string = '本次小比赛将于' + self.parseDate(matchData.endtime) + '结束';\r\n\r\n        // var endTime = new Date();\r\n        // endTime.setTime(matchData.endtime * 1000);\r\n        // console.log('endtime:', util.formatTime(endTime));\r\n\r\n        self.challengeBtn.interactable = false;\r\n        match.queryMyMatch({\r\n            matchId: self.matchId,\r\n            success: res => {\r\n                console.log('query my match success, res:', res);\r\n                if (res.matchstate) {\r\n                    self.matchState = res.matchstate;\r\n                }\r\n                if (res.moneystate) {\r\n                    self.moneyState = res.moneystate;\r\n                }\r\n                self.updateChallengeView();\r\n            },\r\n            fail: res => {\r\n                console.log('query my match fail, res:', res);\r\n                // self.challengePanel.active = false;\r\n                self.onCloseBtnClick();\r\n            }\r\n        });\r\n    },\r\n\r\n    initRankView (rankData) {\r\n        self.bestList = [];\r\n        self.content.removeAllChildren();\r\n\r\n        // 设置前三\r\n        for (var i = 0; i < 3; i++) {\r\n            var value = rankData.shift();\r\n            if (!!value) {\r\n                self.bestList.push(value);\r\n            }\r\n        }\r\n        self.initBestThree(self.bestList);\r\n\r\n        // 设置之后\r\n        self.initScrollView(rankData);\r\n    },\r\n\r\n    initBestThree (list) {\r\n        for (var i = 0; i < 3; i++) {\r\n            var data = list[i];\r\n            if (typeof data != 'undefined') {\r\n                self.updateBestData(data, i);\r\n                self.bestThreeWidgets[i].active = true;\r\n            } else {\r\n                self.bestThreeWidgets[i].active = false;\r\n            }\r\n        }\r\n    },\r\n\r\n    updateBestData (data, index) {\r\n        var widget = self.bestThreeWidgets[index];\r\n        var name = cc.find('name', widget).getComponent(cc.Label);\r\n        var grade = cc.find('grade', widget).getComponent(cc.Label);\r\n        var image = cc.find('mask/image', widget).getComponent(cc.Sprite);\r\n\r\n        name.string = data.name || '';\r\n        grade.string = data.score || 0;\r\n\r\n        //获取人物头像\r\n        var texture = data.portrait;\r\n        if (!texture) {\r\n            return;\r\n        }\r\n        texture = texture.split(\"/0\", 1);\r\n        texture = texture + \"/64\";\r\n        cc.loader.load({ url: texture, type: 'png' }, function (err, texture) {\r\n            ////console.log(\"loadUrl\",texture instanceof cc.Texture2D)\r\n            var spriteFrame = new cc.SpriteFrame();\r\n            spriteFrame.setTexture(texture);\r\n            image.spriteFrame = spriteFrame;\r\n        })\r\n    },\r\n\r\n    initScrollView (rankData) {\r\n        for (var i = 0; i < rankData.length; i++) {\r\n            var item = self.createRankItem(rankData[i], i);\r\n            self.content.addChild(item);\r\n        }\r\n        self.scrollView.scrollToTop(0);\r\n    },\r\n\r\n    createRankItem (data, index) {\r\n        var item = cc.instantiate(self.rankItem);\r\n        item.getComponent('matchRankItem').init(data, index);\r\n        return item;\r\n    },\r\n\r\n    updateChallengeView () {\r\n        console.log('update challenge view, matchState: ' + self.matchState + ' moneyState: ' + self.moneyState);\r\n\r\n        if (self.matchState == 0) {\r\n            self.challengeBtnLb.string = '比赛已结束';\r\n            self.endTimeDesc.string = '本次小比赛已于' + self.parseDate(matchData.endtime) + '结束';\r\n            return;\r\n        }\r\n\r\n        if (self.matchState == 1) {\r\n            self.challengeBtnLb.string = '挑战领赏金';\r\n            return;\r\n        }\r\n\r\n        if (self.moneyState == 0) {\r\n            self.challengeBtnLb.string = '挑战领赏金';\r\n        } else if (self.moneyState == 1) {\r\n            self.challengeBtnLb.string = '领取赏金';\r\n        } else if (self.moneyState == 2) {\r\n            self.challengeBtnLb.string = '挑战排名';\r\n            self.endTimeDesc.string = '近期已领取过此游戏比赛赏金';\r\n        }\r\n\r\n        self.challengeBtn.interactable = true;\r\n    },\r\n\r\n    onCloseBtnClick () {\r\n        self.node.active = false;\r\n    },\r\n\r\n    onChallengeBtnClick () {\r\n        console.log('on challenge btn click, matchState: ' + self.matchState + ' moneyState: ' + self.moneyState);\r\n\r\n        // 领取赏金\r\n        if (self.matchState == 2 && self.moneyState == 1) {\r\n            match.getCurMatchMoney({\r\n                matchId: self.matchId,\r\n                success: res => {\r\n                    // 之后应该从服务器获取state\r\n                    self.moneyState = 2;\r\n                    self.updateChallengeView();\r\n\r\n                    wx.showToast({\r\n                        title: '赏金领取成功',\r\n                        duration: 1500\r\n                    });\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        // 加入比赛\r\n        if (self.matchState == 1) {\r\n            match.enterMatch(function () {\r\n                wx.showToast({\r\n                    title: '加入比赛成功',\r\n                    duration: 1500\r\n                });\r\n            });\r\n        } else {\r\n            wx.showToast({\r\n                title: '开始挑战',\r\n                duration: 1500\r\n            });\r\n        }\r\n        self.onCloseBtnClick();\r\n    },\r\n\r\n    onWithdrawClick () {\r\n        match.getAllMoney(function (data) {\r\n            self.withdrawView.active = true;\r\n            self.allMoneyLb.string = (data.allmoney || '0') + '元';\r\n        });\r\n    },\r\n\r\n    parseDate (time) {\r\n        var datetime = new Date();\r\n        datetime.setTime(time * 1000);\r\n        // var year = datetime.getFullYear();\r\n        var month = datetime.getMonth() + 1;\r\n        var date = datetime.getDate();\r\n        var hour = datetime.getHours();\r\n        var minute = datetime.getMinutes();\r\n        // var second = datetime.getSeconds();\r\n        // var mseconds = datetime.getMilliseconds();\r\n        return month + \"/\" + date + \" \" + hour + \":\" + minute;\r\n    }\r\n});\r\n"]}