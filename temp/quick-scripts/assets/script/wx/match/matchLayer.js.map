{"version":3,"sources":["matchLayer.js"],"names":["util","require","match","matchManager","getInstance","self","cc","Class","extends","Component","properties","onLoad","marquee","find","node","marqueeItem","active","shareBtn","on","onShare","closeBtn","onClose","marqueeList","Array","marqueePool","NodePool","i","item","instantiate","put","createMarqueeItem","prePos","start","init","data","console","log","matchData","wx","shareAppMessage","title","query","_id","starttime","endtime","limitscore","success","res","getQunRankInfo","shareTickets","fail","updateMarqueeItem","lb","getComponent","Label","name","randomStr","num","Math","random","toFixed","string","get","addChild","destPos","Vec2","ZERO","delta","length","last","x","width","setPosition","push","getActionByTag","action","repeatForever","moveBy","setTag","runAction","update","dt","first","shift"],"mappings":"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","file":"matchLayer.js","sourceRoot":"../../../../../../assets/script/wx/match","sourcesContent":["var util = require('../utils/util');\r\nvar match = require('./match');\r\nvar matchManager = require('matchManager').getInstance();\r\nvar self = null;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        self = this;\r\n\r\n        // 跑马灯父节点\r\n        self.marquee = cc.find('tips/marquee', self.node);\r\n        self.marqueeItem = cc.find('prizeInfo', self.marquee);\r\n        self.marqueeItem.active = false;\r\n\r\n        var shareBtn = cc.find('shareBtn', self.node);\r\n        shareBtn.on('click', self.onShare, self);\r\n\r\n        var closeBtn = cc.find(\"closeBtn\", self.node);\r\n        closeBtn.on('click', self.onClose, self);\r\n\r\n        // 跑马灯相关设置\r\n        self.marqueeList = new Array();\r\n        self.marqueePool = new cc.NodePool();\r\n\r\n        for (var i = 0; i < 3; i++) {\r\n            var item = cc.instantiate(self.marqueeItem);\r\n            self.marqueePool.put(item);\r\n        }\r\n\r\n        for (var i = 0; i < 3; i++) {\r\n            self.createMarqueeItem();\r\n        }\r\n\r\n        self.prePos = null;\r\n\r\n        // 微信设置\r\n        /*\r\n        wx.onShareAppMessage(function () {\r\n            return {\r\n                title: '转发标题',\r\n                success: res => {\r\n                    console.log(\"shareAppMessage\", res);\r\n                },\r\n                fail: res => {\r\n                    console.log(\"shareAppMessage fail\", res)\r\n                }\r\n            }\r\n        }) */\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    init (data) {\r\n        console.log('data:', data);\r\n        self.matchData = data;\r\n        // self.matchId = data._id;\r\n    },\r\n\r\n    onShare () {\r\n        wx.shareAppMessage({\r\n            title: '来玩啊',\r\n            // query: {\r\n            //     matchId: self.matchData.matchId,\r\n            //     starttime: self.matchData.starttime,\r\n            //     endtime: self.matchData.endtime,\r\n            //     limitscore: self.matchData.limitscore\r\n            // },\r\n            query: 'matchId=' + self.matchData._id +\r\n                   '&starttime=' + self.matchData.starttime +\r\n                   '&endtime=' + self.matchData.endtime +\r\n                   '&limitscore=' + self.matchData.limitscore,\r\n            success: res => {\r\n                console.log('match share success >>>>>>>>>>');\r\n                // 转发到群成功后会拿到一个shareTicket，用来获取群相关信息\r\n                console.log('success response:', res);\r\n\r\n                // 通过返回的shareTicket获取群相关的信息\r\n                matchManager.getQunRankInfo(res.shareTickets[0]);\r\n\r\n                self.onClose();\r\n            },\r\n            fail: res => {\r\n                console.log('match share failed >>>>>>>>>>');\r\n                console.log('fail response:', res);\r\n            }\r\n        })\r\n    },\r\n\r\n    onClose () {\r\n        self.node.active = false;\r\n        // self.node.parent\r\n    },\r\n\r\n    updateMarqueeItem (item) {\r\n        var lb = item.getComponent(cc.Label);\r\n        var name = util.randomStr(5);\r\n        var num = 0.01 + Math.random() * 10;\r\n        num = num.toFixed(2);\r\n        lb.string = name + '获得' + num + '元';\r\n    },\r\n\r\n    createMarqueeItem () {\r\n        var item = self.marqueePool.get();\r\n        if (item == null) {\r\n            item = cc.instantiate(self.marqueeItem);\r\n        }\r\n        item.active = true;\r\n\r\n        self.updateMarqueeItem(item);\r\n\r\n        // 设置位置\r\n        self.marquee.addChild(item);\r\n        var destPos = cc.Vec2.ZERO;\r\n        var delta = 20;\r\n        if (self.marqueeList.length > 0) {\r\n            var last = self.marqueeList[self.marqueeList.length - 1];\r\n            destPos.x = last.x + last.width / 2 + item.width / 2 + delta;\r\n        }\r\n        item.setPosition(destPos);\r\n        self.marqueeList.push(item);\r\n\r\n        // 设置动作\r\n        if (!item.getActionByTag(1)) {\r\n            var action = cc.repeatForever(cc.moveBy(1, -100, 0));\r\n            action.setTag(1);\r\n            item.runAction(action);\r\n        }\r\n    },\r\n\r\n    update (dt) {\r\n        if (self.marqueeList.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        var first = self.marqueeList[0];\r\n        if (first.x + first.width / 2 < self.marquee.x - self.marquee.width / 2) {\r\n            var item = self.marqueeList.shift();\r\n\r\n            self.marqueePool.put(item);\r\n            self.createMarqueeItem();\r\n        }\r\n    },\r\n});\r\n"]}