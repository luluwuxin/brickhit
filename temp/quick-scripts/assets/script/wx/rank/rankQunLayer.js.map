{"version":3,"sources":["rankQunLayer.js"],"names":["config","require","self","cc","Class","extends","Component","properties","listItem","default","type","Prefab","onLoad","_listData","Array","_bestsData","_weekRankTitle","find","node","getComponent","Label","_loopScrollView","_initLoopScrollView","_rankShowWidget","i","index","register","maskTouch","event","cusData","stopPropagation","loadTexture","list","textureDatas","length","texture","portrait","split","loader","load","url","err","spriteFrame","SpriteFrame","push","backbtn","on","_callBack","active","start","createItem","info","_item","instantiate","itemJs","init","clearList","destroy","data","callbacks","isWeek","console","log","string","splice","value","UID","uid","_myRank","myRnakWidget","initBestsData","setTotalNum","shift","_initBestsView","_initBest","path","_rank","name","grade","location","image","Sprite","score","city","setTexture","registerCreateItemFunc","itemNode","registerUpdateItemFunc","cell","js","_worldsData"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAIA,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,OAAO,IAAX;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,kBAAU;AACNC,qBAAQ,IADF;AAENC,kBAAKP,GAAGQ;AAFF;AAhBF,KAHP;;AAyBL;;AAEAC,UA3BK,oBA2BK;AACNV,eAAO,IAAP;AACAA,aAAKW,SAAL,GAAiB,IAAIC,KAAJ,EAAjB;AACAZ,aAAKa,UAAL,GAAkB,IAAID,KAAJ,EAAlB;AACAZ,aAAKc,cAAL,GAAsBb,GAAGc,IAAH,CAAQ,WAAR,EAAoBf,KAAKgB,IAAzB,EAA+BC,YAA/B,CAA4ChB,GAAGiB,KAA/C,CAAtB;AACAlB,aAAKmB,eAAL,GAAuBlB,GAAGc,IAAH,CAAQ,YAAR,EAAqBf,KAAKgB,IAA1B,EAAgCC,YAAhC,CAA6C,kBAA7C,CAAvB;AACAjB,aAAKoB,mBAAL;AACApB,aAAKqB,eAAL,GAAuB,IAAIT,KAAJ,EAAvB;AACA,aAAI,IAAIU,IAAI,CAAZ,EAAeA,IAAI,CAAnB,EAAuBA,GAAvB,EAA2B;AACvB,gBAAIC,QAAQD,IAAE,CAAd;AACAtB,iBAAKqB,eAAL,CAAqBC,CAArB,IAA0BrB,GAAGc,IAAH,CAAQ,cAAYQ,KAApB,EAA0BvB,KAAKgB,IAA/B,CAA1B;AACH;AACDhB,aAAKwB,QAAL;AACH,KAxCI;AAyCLC,aAzCK,qBAyCKC,KAzCL,EAyCWC,OAzCX,EAyCmB;AACpB,YAAGD,KAAH,EAAS;AACLA,kBAAME,eAAN;AACH;AACJ,KA7CI;AA8CLC,eA9CK,uBA8COC,IA9CP,EA8CYC,YA9CZ,EA8CyB;AAC1B,aAAI,IAAIT,IAAI,CAAZ,EAAgBA,IAAIQ,KAAKE,MAAzB,EAAiCV,GAAjC,EAAqC;AACjC,gBAAIW,UAAUH,KAAKR,CAAL,EAAQY,QAAtB;AACA,gBAAI,CAACD,OAAL,EAAa;AACT;AACH;AACDA,sBAAUA,QAAQE,KAAR,CAAc,IAAd,EAAmB,CAAnB,CAAV;AACAF,sBAAUA,UAAU,KAApB;AACAhC,eAAGmC,MAAH,CAAUC,IAAV,CAAe,EAACC,KAAIL,OAAL,EAAczB,MAAK,KAAnB,EAAf,EAAyC,UAAS+B,GAAT,EAAaN,OAAb,EAAqB;AAC1D,oBAAIO,cAAc,IAAIvC,GAAGwC,WAAP,EAAlB;AACA;AACAV,6BAAaW,IAAb,CAAkBF,WAAlB;AACH,aAJD;AAKH;AACJ,KA5DI;AA6DLhB,YA7DK,sBA6DK;AACN,YAAImB,UAAU1C,GAAGc,IAAH,CAAQ,aAAR,EAAsBf,KAAKgB,IAA3B,CAAd;AACA2B,gBAAQC,EAAR,CAAW,OAAX,EAAmB,UAASlB,KAAT,EAAe;AAC9B,gBAAG1B,KAAK6C,SAAR,EAAkB;AACd7C,qBAAK6C,SAAL;AACH;AACD7C,iBAAKgB,IAAL,CAAU8B,MAAV,GAAmB,KAAnB;AACH,SALD,EAKE9C,IALF;AAMH,KArEI;AAsEL+C,SAtEK,mBAsEI,CAER,CAxEI;AAyELC,cAzEK,sBAyEM1B,CAzEN,EAyEQ2B,IAzER,EAyEa;AACd,YAAIC,QAAQjD,GAAGkD,WAAH,CAAenD,KAAKM,QAApB,CAAZ;AACA,YAAI8C,SAASF,MAAMjC,YAAN,CAAmB,MAAnB,CAAb;AACAmC,eAAOC,IAAP,CAAYJ,IAAZ,EAAiB3B,CAAjB;AACA,eAAO4B,KAAP;AACH,KA9EI;;AA+EL;AACAI,aAhFK,qBAgFKxB,IAhFL,EAgFU;AACX,aAAI,IAAIR,IAAI,CAAZ,EAAeA,IAAGQ,KAAKE,MAAvB,EAA+BV,GAA/B,EAAmC;AAC/BQ,iBAAKR,CAAL,EAAQiC,OAAR;AACAzB,iBAAKR,CAAL,IAAU,CAAV;AACH;AACJ,KArFI;AAsFL+B,QAtFK,gBAsFAG,IAtFA,EAsFKC,SAtFL,EAsFeC,MAtFf,EAsFsB;AACvBC,gBAAQC,GAAR,CAAY,SAAZ,EAAsBJ,IAAtB;AACA,YAAGE,MAAH,EAAU;AACN1D,iBAAKc,cAAL,CAAoB+C,MAApB,GAA6B,MAA7B;AACH,SAFD,MAEK;AACD7D,iBAAKc,cAAL,CAAoB+C,MAApB,GAA6B,MAA7B;AACH;AACD7D,aAAKW,SAAL,CAAemD,MAAf,CAAsB,CAAtB,EAAwB9D,KAAKW,SAAL,CAAeqB,MAAvC;AACA,YAAI+B,QAAQP,IAAZ;AACA,aAAI,IAAIlC,IAAI,CAAZ,EAAeA,IAAGyC,MAAM/B,MAAxB,EAAgCV,GAAhC,EAAoC;AAChCtB,iBAAKW,SAAL,CAAeW,CAAf,IAAoByC,MAAMzC,CAAN,CAApB;AACAqC,oBAAQC,GAAR,CAAY,OAAZ,EAAoB9D,OAAOkE,GAA3B,EAA+BD,MAAMzC,CAAN,EAAS2C,GAAxC;AACA,gBAAGF,MAAMzC,CAAN,EAAS2C,GAAT,IAAgBnE,OAAOkE,GAA1B,EAA8B;;AAE1BhE,qBAAKkE,OAAL,GAAe5C,IAAI,CAAnB;AACH;AACJ;AACD;AACAtB,aAAK6C,SAAL,GAAiBY,SAAjB;AACA;AACA,YAAIU,eAAelE,GAAGc,IAAH,CAAQ,iBAAR,EAA0Bf,KAAKgB,IAA/B,CAAnB;AACA,YAAGhB,KAAKkE,OAAR,EAAgB;AACZC,yBAAalD,YAAb,CAA0BhB,GAAGiB,KAA7B,EAAoC2C,MAApC,GAA6C,UAAS7D,KAAKkE,OAA3D;AACH,SAFD,MAEK;AACDC,yBAAalD,YAAb,CAA0BhB,GAAGiB,KAA7B,EAAoC2C,MAApC,GAA6C,UAA7C;AACH;AACD7D,aAAKoE,aAAL;AACA;AACApE,aAAKmB,eAAL,CAAqBkD,WAArB,CAAiCrE,KAAKW,SAAL,CAAeqB,MAAhD;AAEH,KApHI;AAqHLoC,iBArHK,2BAsHL;AACIpE,aAAKa,UAAL,CAAgBiD,MAAhB,CAAuB,CAAvB,EAAyB9D,KAAKa,UAA9B;AACA,aAAI,IAAIS,IAAI,CAAZ,EAAeA,IAAI,CAAnB,EAAuBA,GAAvB,EAA2B;AACvB,gBAAIyC,QAAQ/D,KAAKW,SAAL,CAAe2D,KAAf,EAAZ;AACA,gBAAG,OAAOP,KAAP,IAAgB,WAAnB,EAA+B;AAC3B/D,qBAAKa,UAAL,CAAgB6B,IAAhB,CAAqBqB,KAArB;AACH;AACJ;AACD/D,aAAKuE,cAAL,CAAoBvE,KAAKa,UAAzB;AACH,KA/HI;AAgIL0D,kBAhIK,0BAgIUzC,IAhIV,EAgIe;AAChB,aAAI,IAAIR,IAAI,CAAZ,EAAeA,IAAI,CAAnB,EAAuBA,GAAvB,EAA2B;AACvB,gBAAIyC,QAAQjC,KAAKR,CAAL,CAAZ;AACA,gBAAG,OAAOyC,KAAP,IAAgB,WAAnB,EAA+B;AAC3B/D,qBAAKwE,SAAL,CAAelD,IAAG,CAAlB,EAAoByC,KAApB;AACA/D,qBAAKqB,eAAL,CAAqBC,CAArB,EAAwBwB,MAAxB,GAAiC,IAAjC;AACH,aAHD,MAGK;AACD9C,qBAAKqB,eAAL,CAAqBC,CAArB,EAAwBwB,MAAxB,GAAiC,KAAjC;AACH;AACJ;AACJ,KA1II;AA2IL0B,aA3IK,qBA2IKjD,KA3IL,EA2IYwC,KA3IZ,EA2IkB;AACnB,YAAIU,OAAO,cAAYlD,KAAvB;AACA;AACA,YAAImD,QAAQzE,GAAGc,IAAH,CAAQ0D,IAAR,EAAazE,KAAKgB,IAAlB,CAAZ;AACA,YAAI2D,OAAO1E,GAAGc,IAAH,CAAQ,MAAR,EAAe2D,KAAf,CAAX;AACAC,eAAOA,KAAK1D,YAAL,CAAkBhB,GAAGiB,KAArB,CAAP;AACA,YAAI0D,QAAQ3E,GAAGc,IAAH,CAAQ,YAAR,EAAqB2D,KAArB,CAAZ;AACAE,gBAAQA,MAAM3D,YAAN,CAAmBhB,GAAGiB,KAAtB,CAAR;AACA,YAAI2D,WAAW5E,GAAGc,IAAH,CAAQ,UAAR,EAAmB2D,KAAnB,CAAf;AACAG,mBAAWA,SAAS5D,YAAT,CAAsBhB,GAAGiB,KAAzB,CAAX;AACA,YAAI4D,QAAQ7E,GAAGc,IAAH,CAAQ,YAAR,EAAqB2D,KAArB,CAAZ;AACAI,gBAAQA,MAAM7D,YAAN,CAAmBhB,GAAG8E,MAAtB,CAAR;;AAEAJ,aAAKd,MAAL,GAAcE,MAAMY,IAAN,IAAc,EAA5B;AACAC,cAAMf,MAAN,GAAeE,MAAMiB,KAAN,IAAe,CAA9B;AACA,YAAGjB,MAAM,MAAN,CAAH,EAAiB;AACbc,qBAAShB,MAAT,GAAkB,QAAME,MAAMkB,IAA9B;AACH;AACD;AACA,YAAIhD,UAAU8B,MAAM7B,QAApB;AACA,YAAI,CAACD,OAAL,EAAa;AACT;AACH;AACDA,kBAAUA,QAAQE,KAAR,CAAc,IAAd,EAAmB,CAAnB,CAAV;AACAF,kBAAUA,UAAU,KAApB;AACAhC,WAAGmC,MAAH,CAAUC,IAAV,CAAe,EAACC,KAAIL,OAAL,EAAczB,MAAK,KAAnB,EAAf,EAAyC,UAAS+B,GAAT,EAAaN,OAAb,EAAqB;AAC1D,gBAAIO,cAAc,IAAIvC,GAAGwC,WAAP,EAAlB;AACAD,wBAAY0C,UAAZ,CAAuBjD,OAAvB;AACA6C,kBAAMtC,WAAN,GAAoBA,WAApB;AAEH,SALD;AAOH,KA3KI;AA4KLpB,uBA5KK,iCA4KgB;AACjBpB,aAAKmB,eAAL,CAAqBgE,sBAArB,CAA4C,YAAU;AAClD,gBAAIC,WAAWnF,GAAGkD,WAAH,CAAenD,KAAKM,QAApB,CAAf;AACA,mBAAO8E,QAAP;AACH,SAHD;AAIApF,aAAKmB,eAAL,CAAqBkE,sBAArB,CAA4C,UAASC,IAAT,EAAc/D,KAAd,EAAoB;AAC5D,gBAAIgE,KAAKD,KAAKrE,YAAL,CAAkB,MAAlB,CAAT;AACAsE,eAAGlC,IAAH,CAAQrD,KAAKwF,WAAL,CAAiBjE,KAAjB,CAAR,EAAgCA,KAAhC;AACH,SAHD;AAIH;AArLI;AAsLL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxMJ","file":"rankQunLayer.js","sourceRoot":"../../../../../../assets/script/wx/rank","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\r\n\r\n//var rank = require('./rank')\r\nvar config = require('config');\r\nvar self = null;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        listItem :{\r\n            default:null,\r\n            type:cc.Prefab,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        self = this;\r\n        self._listData = new Array();\r\n        self._bestsData = new Array();\r\n        self._weekRankTitle = cc.find('top/Title',self.node).getComponent(cc.Label);\r\n        self._loopScrollView = cc.find('rankScroll',self.node).getComponent('uiloopscrollview');\r\n        self._initLoopScrollView();\r\n        self._rankShowWidget = new Array();\r\n        for(var i = 0; i < 3 ; i++){\r\n            var index = i+1;\r\n            self._rankShowWidget[i] = cc.find(\"top/rank_\"+index,self.node);\r\n        }\r\n        self.register()\r\n    },\r\n    maskTouch(event,cusData){\r\n        if(event){\r\n            event.stopPropagation();\r\n        }\r\n    },\r\n    loadTexture(list,textureDatas){\r\n        for(var i = 0 ; i < list.length; i++){\r\n            var texture = list[i].portrait;\r\n            if (!texture){\r\n                continue;\r\n            }\r\n            texture = texture.split(\"/0\",1); \r\n            texture = texture + \"/64\";\r\n            cc.loader.load({url:texture, type:'png'},function(err,texture){\r\n                var spriteFrame = new cc.SpriteFrame();\r\n                //spriteFrame.setTexture(texture)\r\n                textureDatas.push(spriteFrame);    \r\n            })            \r\n        }\r\n    },\r\n    register(){\r\n        var backbtn = cc.find(\"top/backBtn\",self.node);\r\n        backbtn.on('click',function(event){\r\n            if(self._callBack){\r\n                self._callBack()\r\n            }\r\n            self.node.active = false\r\n        },self)\r\n    },\r\n    start () {\r\n\r\n    },\r\n    createItem(i,info){\r\n        var _item = cc.instantiate(self.listItem);\r\n        var itemJs = _item.getComponent('item')\r\n        itemJs.init(info,i);\r\n        return _item ;\r\n    },\r\n    //处理new 出来的数据\r\n    clearList(list){\r\n        for(var i = 0; i< list.length; i++){\r\n            list[i].destroy();\r\n            list[i] = 0;\r\n        }       \r\n    },\r\n    init(data,callbacks,isWeek){\r\n        console.log(\"qundata\",data)\r\n        if(isWeek){\r\n            self._weekRankTitle.string = '群排行榜'\r\n        }else{\r\n            self._weekRankTitle.string = '群排行榜' \r\n        }\r\n        self._listData.splice(0,self._listData.length)\r\n        var value = data;\r\n        for(let i = 0; i< value.length; i++){\r\n            self._listData[i] = value[i];\r\n            console.log(\"myUID\",config.UID,value[i].uid)\r\n            if(value[i].uid == config.UID){\r\n                \r\n                self._myRank = i + 1;  \r\n            }\r\n        }\r\n        //self._myRank = data.myRank\r\n        self._callBack = callbacks\r\n        //我的排名\r\n        var myRnakWidget = cc.find(\"myRankBg/myRank\",self.node)\r\n        if(self._myRank){\r\n            myRnakWidget.getComponent(cc.Label).string = \"我的排名：\"+ self._myRank;\r\n        }else{\r\n            myRnakWidget.getComponent(cc.Label).string = \"我的排名：未上榜\";    \r\n        }\r\n        self.initBestsData()\r\n        //self._initScroll(self.rankScroll,self._listData.length,self._listData);\r\n        self._loopScrollView.setTotalNum(self._listData.length);\r\n        \r\n    },\r\n    initBestsData()\r\n    {\r\n        self._bestsData.splice(0,self._bestsData)\r\n        for(let i = 0; i < 3 ; i++){\r\n            var value = self._listData.shift()\r\n            if(typeof(value) !=\"undefined\"){ \r\n                self._bestsData.push(value) \r\n            }\r\n        }\r\n        self._initBestsView(self._bestsData)\r\n    },\r\n    _initBestsView(list){\r\n        for(let i = 0; i < 3 ; i++){\r\n            var value = list[i];\r\n            if(typeof(value) !=\"undefined\"){ \r\n                self._initBest(i +1,value)\r\n                self._rankShowWidget[i].active = true;\r\n            }else{\r\n                self._rankShowWidget[i].active = false ;            \r\n            }\r\n        }      \r\n    },\r\n    _initBest(index, value){\r\n        var path = \"top/rank_\"+index\r\n        //这些都无用\r\n        var _rank = cc.find(path,self.node);\r\n        var name = cc.find(\"name\",_rank);\r\n        name = name.getComponent(cc.Label)\r\n        var grade = cc.find(\"star/grade\",_rank);\r\n        grade = grade.getComponent(cc.Label)\r\n        var location = cc.find(\"location\",_rank);\r\n        location = location.getComponent(cc.Label)\r\n        var image = cc.find(\"mask/image\",_rank);\r\n        image = image.getComponent(cc.Sprite)\r\n\r\n        name.string = value.name || \"\";\r\n        grade.string = value.score || 0 ;\r\n        if(value[\"city\"]){\r\n            location.string = \"地区:\"+value.city;\r\n        }    \r\n        //获取人物头像\r\n        var texture = value.portrait;\r\n        if (!texture){\r\n            return\r\n        }\r\n        texture = texture.split(\"/0\",1); \r\n        texture = texture + \"/64\";\r\n        cc.loader.load({url:texture, type:'png'},function(err,texture){\r\n            var spriteFrame = new cc.SpriteFrame();\r\n            spriteFrame.setTexture(texture)\r\n            image.spriteFrame = spriteFrame\r\n\r\n        })\r\n\r\n    },\r\n    _initLoopScrollView(){\r\n        self._loopScrollView.registerCreateItemFunc(function(){\r\n            var itemNode = cc.instantiate(self.listItem);\r\n            return itemNode;\r\n        });\r\n        self._loopScrollView.registerUpdateItemFunc(function(cell,index){\r\n            var js = cell.getComponent('item');\r\n            js.init(self._worldsData[index],index);\r\n        });\r\n    },\r\n    // _initScroll(_scroll, num, data){\r\n    //     var _height = 0\r\n    //     var content = _scroll\r\n        \r\n    //     for(let i = 0 ; i < num;i ++){\r\n    //         var item = self.createItem(i,data[i])       \r\n    //         content.addChild(item)\r\n    //         if (_height === 0){\r\n    //             _height = item.getContentSize().height\r\n    //         }\r\n    //         item.setPosition(0,- i * _height - _height/2)\r\n    //     };\r\n    //     var contentSize = content.getContentSize()\r\n    //     if (_height*num > contentSize.height){\r\n    //         content.setContentSize (contentSize.width, _height*num)\r\n    //     }\r\n    //     contentSize = content.getContentSize()\r\n    // },\r\n    // update (dt) {},\r\n});\r\n"]}