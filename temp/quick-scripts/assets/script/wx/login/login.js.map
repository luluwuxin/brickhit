{"version":3,"sources":["login.js"],"names":["urls","require","config","util","userOperate","getUseInfo","cc","sys","platform","WECHAT_GAME","wx","getUserInfo","success","console","log","res","userInfo","setUserInfo","login","code","fail","param","getParam","sign","request","url","data","d","ecode","UID","sessionkey","getUserData","msg","JSON","stringify","er","error","module","exports"],"mappings":";;;;;;AAAA,IAAIA,OAAOC,QAAQ,QAAR,EAAkBD,IAA7B;AACA,IAAIE,SAASD,QAAQ,QAAR,CAAb;AACA,IAAIE,OAAOF,QAAQ,eAAR,CAAX;AACA,IAAIG,cAAcH,QAAQ,4BAAR,CAAlB;AACAG,cAAc,IAAIA,WAAJ,EAAd;AACA;AACA,IAAMC,aAAa,SAAbA,UAAa,GAAU;AAC3B,MAAGC,GAAGC,GAAH,CAAOC,QAAP,IAAmBF,GAAGC,GAAH,CAAOE,WAA7B,EAAyC;AACrCC,OAAGC,WAAH,CAAe;AACXC,eAAQ,sBAAK;AACTC,gBAAQC,GAAR,CAAYC,GAAZ;AACAb,eAAOc,QAAP,GAAkBD,IAAIC,QAAtB;AACAZ,oBAAYa,WAAZ;AACH;AALU,KAAf;AAOH;AACF,CAVD;;AAYA,IAAMC,QAAQ,SAARA,KAAQ,CAAUC,IAAV,EAAgBP,QAAhB,EAAwBQ,KAAxB,EAA8B;AAC1C,MAAIC,QAAQnB,OAAOoB,QAAP,EAAZ;AACAD,QAAM,SAAN,IAAmBlB,KAAKoB,IAAL,CAAUF,KAAV,CAAnB;AACAA,QAAM,SAAN,IAAmBF,IAAnB;AACAhB,OAAKqB,OAAL,CAAa;AACXC,SAAKzB,KAAKkB,KADC;AAEXQ,UAAML,KAFK;AAGXT,aAAS,iBAAUG,GAAV,EAAe;AACtB,UAAIY,IAAIZ,IAAIW,IAAZ;AACA,UAAIC,MAAMA,EAAEC,KAAF,IAAW,CAAX,IAAgBD,EAAEC,KAAF,IAAW,CAAjC,CAAJ,EAAyC;AACvCf,gBAAQC,GAAR,CAAY,SAAZ,EAAsBC,GAAtB;AACA,YAAGA,IAAIW,IAAJ,CAAS,KAAT,CAAH,EAAmB;AACjBxB,iBAAO2B,GAAP,GAAad,IAAIW,IAAJ,CAAS,KAAT,CAAb;AACD;AACD,YAAGX,IAAIW,IAAJ,CAAS,YAAT,CAAH,EAA0B;AACxBxB,iBAAO4B,UAAP,GAAoBf,IAAIW,IAAJ,CAASI,UAA7B;AACD;AACD;AACA1B,oBAAY2B,WAAZ,CAAwB,YAAU;AAChC,cAAInB,YAAW,OAAOA,QAAP,IAAkB,UAAjC,EAA6CA;AAC9C,SAFD;AAID,OAbD,MAaO;AACL,YAAIoB,MAAM,uBAAuBC,KAAKC,SAAL,CAAenB,GAAf,CAAjC;AACA,YAAIK,SAAQ,OAAOA,KAAP,IAAe,UAA3B,EAAuCA;AACxC;AACF,KAtBU;AAuBXA,UAAM,cAAUe,EAAV,EAAc;AAClBtB,cAAQuB,KAAR,CAAcD,EAAd;AACA,UAAIf,SAAQ,OAAOA,KAAP,IAAe,UAA3B,EAAuCA;AACxC;AA1BU,GAAb;AA4BD,CAhCD;AAiCAiB,OAAOC,OAAP,GAAiB;AACfpB,SAAOA,KADQ;AAEfb,cAAWA;AAFI,CAAjB","file":"login.js","sourceRoot":"../../../../../../assets/script/wx/login","sourcesContent":["var urls = require('config').urls\r\nvar config = require('config')\r\nvar util = require('../utils/util');\r\nvar userOperate = require('../userOperate/userOperate');\r\nuserOperate = new userOperate();\r\n// 获取用户信息\r\nconst getUseInfo = function(){\r\n  if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n      wx.getUserInfo({\r\n          success:res=>{\r\n              console.log(res)\r\n              config.userInfo = res.userInfo            \r\n              userOperate.setUserInfo()\r\n          },\r\n      })\r\n  }\r\n};\r\n\r\nconst login = function (code, success,fail) {\r\n  var param = config.getParam();\r\n  param[\"appsign\"] = util.sign(param);\r\n  param[\"js_code\"] = code;\r\n  util.request({\r\n    url: urls.login,\r\n    data: param,\r\n    success: function (res) {\r\n      var d = res.data;\r\n      if (d && (d.ecode == 0 || d.ecode == 2)) {\r\n        console.log(\"login +\",res)\r\n        if(res.data[\"uid\"]){\r\n          config.UID = res.data[\"uid\"] ;\r\n        }\r\n        if(res.data['sessionkey']){\r\n          config.sessionkey = res.data.sessionkey;\r\n        }\r\n        // 登录成功 获取用户数据 再登录回调\r\n        userOperate.getUserData(function(){\r\n          if (success && typeof success == 'function') success();\r\n        });\r\n        \r\n      } else {\r\n        var msg = \"server login fail.\" + JSON.stringify(res);\r\n        if (fail && typeof fail == 'function') fail();\r\n      }\r\n    },\r\n    fail: function (er) {\r\n      console.error(er);\r\n      if (fail && typeof fail == 'function') fail();\r\n    }\r\n  });\r\n}\r\nmodule.exports = {\r\n  login: login,\r\n  getUseInfo:getUseInfo,\r\n}"]}