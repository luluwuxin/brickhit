{"version":3,"sources":["../../../../../../assets/script/wx/share/assets/script/wx/share/shareUtil.js"],"names":["config","require","util","ShareUtil","cc","Class","statics","instance","getInstance","ctor","sharedGroupList","loadShareGroupInfo","_sharedGroupList","sharedGroupListItem","sys","localStorage","getItem","Array","setItem","JSON","stringify","parse","console","log","i","length","groupInfo","isToday","timestamp","splice","shareGroupTime","setShareGroupInfo","openGID","exist","Date","getTime","push","time","toDateString"],"mappings":"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","file":"shareUtil.js","sourceRoot":"../../../../../../assets/script/wx/share","sourcesContent":["var config = require('config');\r\nvar util = require('util');\r\n// var Share = require('share');\r\n\r\nvar ShareUtil = cc.Class({\r\n    statics: {\r\n        instance: null,\r\n        getInstance: function () {\r\n            if (ShareUtil.instance == null) {\r\n                ShareUtil.instance = new ShareUtil();\r\n            }\r\n            return ShareUtil.instance;\r\n        }\r\n    },\r\n\r\n    ctor: function () {\r\n        this.sharedGroupList = null;\r\n        this.loadShareGroupInfo();\r\n    },\r\n\r\n    loadShareGroupInfo: function () {\r\n        // let _sharedGroupList = JSON.parse(cc.sys.localStorage.getItem('sharedGroupList'));\r\n        let _sharedGroupList;\r\n        let sharedGroupListItem = cc.sys.localStorage.getItem('sharedGroupList');\r\n        if (!sharedGroupListItem) {\r\n            sharedGroupListItem = new Array();\r\n            cc.sys.localStorage.setItem('sharedGroupList', JSON.stringify(sharedGroupListItem));\r\n\r\n            _sharedGroupList = sharedGroupListItem;\r\n        } else {\r\n            _sharedGroupList = JSON.parse(sharedGroupListItem);\r\n        }\r\n\r\n        console.log('loadShareGroupInfo group:', _sharedGroupList);\r\n        let i = _sharedGroupList.length;\r\n        while (i--) {\r\n            let groupInfo = _sharedGroupList[i];\r\n            // 删除过期记录\r\n            if (!this.isToday(groupInfo.timestamp)) {\r\n                console.log('timestamp Invalid, not today:', groupInfo.timestamp);\r\n                _sharedGroupList.splice(i, 1);\r\n            }\r\n        }\r\n\r\n        this.sharedGroupList = _sharedGroupList;\r\n        config.shareGroupTime = _sharedGroupList.length;\r\n        cc.sys.localStorage.setItem('sharedGroupList', JSON.stringify(this.sharedGroupList));\r\n\r\n        console.log('loaded shareGroupTime:', config.shareGroupTime);\r\n    },\r\n\r\n    setShareGroupInfo: function (openGID) {\r\n        let i = this.sharedGroupList.length;\r\n        while (i--) {\r\n            let groupInfo = this.sharedGroupList[i];\r\n            // 删除过期记录\r\n            if (!this.isToday(groupInfo.timestamp)) {\r\n                console.log('timestamp Invalid, not today, will be delete:', groupInfo.timestamp);\r\n                this.sharedGroupList.splice(i, 1);\r\n            }\r\n        }\r\n\r\n        let exist = false;\r\n        for (let i = 0; i < this.sharedGroupList.length; i++) {\r\n            if (this.sharedGroupList[i].openGID == openGID) {\r\n                exist = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        // 新的群id\r\n        if (!exist) {\r\n            console.log('group open id will be saved:', openGID);\r\n            let groupInfo = {\r\n                openGID: openGID,\r\n                timestamp: new Date().getTime()\r\n            }\r\n            this.sharedGroupList.push(groupInfo);\r\n\r\n            config.shareGroupTime = this.sharedGroupList.length;\r\n            cc.sys.localStorage.setItem('sharedGroupList', JSON.stringify(this.sharedGroupList));\r\n        } else {\r\n            console.log('group open id already exist:', openGID);\r\n        }\r\n    },\r\n\r\n    isToday (time) {\r\n        return new Date(time).toDateString() === new Date().toDateString();\r\n    },\r\n});\r\n"]}