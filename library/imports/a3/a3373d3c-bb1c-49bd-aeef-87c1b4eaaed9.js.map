{"version":3,"sources":["../../../../assets/scripts/assets/scripts/Game.js"],"names":["common","require","Const","window","gameScore","gameBalls","gameScore1","self","cc","Class","extends","Component","properties","rebornLayout","brickLayout","ground","player","ballsMnt","Node","ctor","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","event","keyCode","KEY","back","director","end","preloadScene","console","log","gameView","getComponent","wxAddLayout","physicsManager","getPhysicsManager","enabled","bannerAd","_bannerAd","startLoop","start","startGame","setShareAssist","updateGold","getGold","init","flg","timeOut","schedule","updateBest","dbGetScore","reset","rebornCtrl","show","reborn","newBrickLayout","ballsMap","removeAllChildren","showBannerAd","newStage","success","repeat","children","map","node","id","stopGame","loadScene","dbSetScore","score","setScore","getScore","addGold","gold","subGold","num","callBack","hideBannerAd","hide","onDestroy"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["//window.console.log = function () { };\n\nlet common = require(\"Common\");\nlet Const = require(\"Const\");\n\nwindow.gameScore = 0;   //记录层数/结束时用于传递最终分数\nwindow.gameBalls = 0;   //总球数\nwindow.gameScore1 = 0;  //记录分数\n\nlet self;\n cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        rebornLayout: require('RebornLayout'),\n        //paddle: require(\"Paddle\"),\n        brickLayout:require(\"BrickLayout\"),\n        ground:require(\"Ground\"),\n        player: require(\"Player\"),\n        ballsMnt: cc.Node,\n    },\n    ctor: function(){\n        self = this;\n    },\n    // use this for initialization\n    onLoad: function () {\n        //自适应\n        //var screenSize = cc.view.getFrameSize();\n        //if (screenSize.height / screenSize.width >= 1.78) {\n        //    this.node.getComponent(cc.Canvas).fitWidth = true\n        //}\n        //else {\n        //    this.node.getComponent(cc.Canvas).fitHeight = true\n        //}\n        //安卓返回键退出\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, function (event) {\n            if (event.keyCode === cc.KEY.back) {\n                cc.director.end();\n            }\n        });\n        cc.director.preloadScene('over', function () {\n            console.log('Next scene preloaded');\n        });\n        this.gameView = this.getComponent(\"GameView\");\n        this.wxAddLayout = this.getComponent(\"wxAddLayer\");\n        this.physicsManager = cc.director.getPhysicsManager();\n        this.physicsManager.enabled = true;\n\n        if(window.bannerAd){\n            this._bannerAd = this.getComponent(\"BannerBlock\");\n            this._bannerAd.startLoop();\n        }\n    },\n    start: function () {\n        this.startGame();\n        this.wxAddLayout.setShareAssist(()=>this.gameView.updateGold(this.getGold()));\n    },\n\n    init: function () {\n        window.gameBalls = 0;\n        window.gameScore = 0;\n        window.gameScore1 = 0;\n        this.physicsManager.enabled = true;\n        //this.gameView.updateScore(gameScore);\n        this.flg = false;\n        let timeOut = 1;\n        this.schedule(()=>{this.flg = true;}, timeOut);\n        this.gameView.updateBest(this.dbGetScore());\n        this.gameView.updateGold(this.getGold());\n        this.rebornLayout.init(this);\n        this.ground.reset(this);\n\n    },\n\n    rebornCtrl: function () { \n        //重生控制逻辑\n        this.physicsManager.enabled = false;\n        this.rebornLayout.show();\n    },\n    reborn: function () {\n        //重生逻辑\n        //window.gameScore = 0;\n        window.gameBalls = 0;\n        this.brickLayout.reset(this);\n        this.brickLayout.newBrickLayout(2);\n        window.gameScore += 2;\n\n        window.ballsMap = {};\n        this.ballsMnt.removeAllChildren();\n        this.physicsManager.enabled = true;\n\n        this.player.reset(this);\n        //this.rebornCtrl();\n    },\n    startGame: function () {\n        this.init();\n        this.showBannerAd();\n        //开始逻辑\n        window.gameScore    = 0;\n        window.gameBalls    = 0;\n        window.gameScore1   = 0;\n\n        window.ballsMap = {};\n        this.ballsMnt.removeAllChildren();\n\n        this.brickLayout.reset(this);\n        this.brickLayout.newBrickLayout(2);\n        window.gameScore += 2;\n        this.player.reset(this);\n        //this.rebornCtrl();\n    },\n    newStage: function(success){\n        if(!this.flg) return;\n        this.flg = false;\n        let repeat = 1;\n        window.ballsMap = {};\n        this.ballsMnt.children.map((node) => window.ballsMap[node.getComponent(\"Ball\").id] = true);\n        if(this.brickLayout.newBrickLayout(repeat)) this.rebornCtrl();\n        window.gameScore += repeat;\n        if(typeof success == \"function\") success();\n    },\n    stopGame: function(){\n        window.gameScore = window.gameScore1;\n        cc.director.loadScene('over');\n    },\n\n    dbSetScore: function (score) {\n        this.wxAddLayout.setScore(window.gameScore1)\n    },\n    dbGetScore: function () {\n        return this.wxAddLayout.getScore();\n    },\n    addGold: function (gold) {\n        this.wxAddLayout.addGold(gold)\n        this.gameView.updateGold(this.getGold());\n    },\n    subGold: function (num, callBack) {\n        let self= this;\n        self.wxAddLayout.subGold(num, (success)=>{\n            if(success)\n                self.gameView.updateGold(this.getGold());\n            if(typeof callBack == \"function\") callBack(success);\n        })\n    },\n    getGold: function () {\n        return this.wxAddLayout.getGold();\n    },\n    showBannerAd: function () {\n        if (this._bannerAd) this._bannerAd.show();\n    },\n    hideBannerAd: function () {\n        if (this._bannerAd) this._bannerAd.hide();\n    },\n    onDestroy: function () {\n        this.physicsManager.enabled = false;\n        this.hideBannerAd();\n    }\n\n});"]}