{"version":3,"sources":["../../../../../../assets/script/wx/share/assets/script/wx/share/share.js"],"names":["urls","require","config","global","globalFunc","util","consume","getInstance","shareUtil","self","share","updateShareMenu","console","log","cc","sys","platform","WECHAT_GAME","wx","withShareTicket","success","res","fail","complete","showShareMenu","onShareAppMessage","_index","Math","random","_title","_titleIndex","floor","shareTitles","length","title","imageUrl","_getImgUrl","query","UID","shareTickets","gamecenter_link","getShareInfo","shareGroup","groupid","url","user","param","request","data","header","method","d","er","error","getShareOpenGid","callBack","sessionKey","sessionkey","encryptedData","iv","openGId","groupOpenGID","getShareOpenGidLocal","decodeOpenId","openid","_shareTicket","shareTicket","gopenid","setShareGroupInfo","shareAppMessage","score","isSpecial","obj","isPeople","wxAddLayer","gold","isAssit","_shareAppMessage","shareAppMessageWithRevived","shareAppMessageWithAssit","shareAppMessageWithGold","shareAppMessageWithImgUrl","shareAppMessageForGroup","shareAppMessageWithSpecial","addFriend","_appID","frienduid","_getStorage","_url","_sharedGroupList","sharedGroupListItem","localStorage","getItem","Array","setItem","JSON","stringify","parse","i","groupInfo","isToday","timestamp","splice","shareGroupTime","Date","getTime","push","time","toDateString","index","isRevive","getTextext","randString","randomString","shareHasCallBack","_setStorage","call","shareWithGold","_isShareWithGold","isShareGold","addGold","addRandString","isGroup"],"mappings":"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OA,QAAP,IAAmB,UAAzD,EAAoE;AAClE2D,iCAAoB,IAApB;AACA3D,uBAAS6D,IAAT,CAAc5C,GAAd,EAAkBkD,OAAlB;AACD;AACF;AACD,cAAGpD,KAAH,EAAS;AACP,gBAAG,CAAC,CAAC,CAAC4C,gBAAH,IAAuB3D,QAAvB,IAAmC,OAAOA,QAAP,IAAmB,UAAzD,EAAoE;AAClE2D,iCAAoB,IAApB;AACA3D,uBAAS6D,IAAT,CAAc5C,GAAd;AACD;AACF;AAEF,SAnFiB;AAoFlBlD,cAAK,mBAAK;AACRV,kBAAQC,GAAR,CAAY,sBAAZ,EAAmCQ,GAAnC;AACD;AAtFiB,OAApB;AAwFD;;;;;;kBA9VoBX;AA+WpB;;AAID;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA","file":"share.js","sourceRoot":"../../../../../../assets/script/wx/share","sourcesContent":["\r\nvar urls = require('config').urls\r\nvar config = require('config');\r\nvar global = require('global');\r\nvar globalFunc = require('globalFunc');\r\nvar util = require('../utils/util');\r\nvar consume = require('consume').getInstance();\r\nvar shareUtil = require('shareUtil').getInstance();\r\nvar self = null;\r\nexport default class share {\r\n  constructor(){\r\n    self = this;\r\n    //this.shareTicket = ''  \r\n    self._getStorage();\r\n    self._url = [{url:'res/raw-assets/resources/share/share1.jpg'},\r\n    {url:'res/raw-assets/resources/share/share2.jpg'}]; \r\n    this.updateShareMenu();\r\n    this.showShareMenu();\r\n    this.onShareAppMessage();\r\n  };\r\n\r\n  _getStorage(){\r\n    let _sharedGroupList;\r\n    let sharedGroupListItem = cc.sys.localStorage.getItem('sharedGroupList');\r\n    if (!sharedGroupListItem) {\r\n        sharedGroupListItem = new Array();\r\n        cc.sys.localStorage.setItem('sharedGroupList', JSON.stringify(sharedGroupListItem));\r\n\r\n        _sharedGroupList = sharedGroupListItem;\r\n    } else {\r\n        _sharedGroupList = JSON.parse(sharedGroupListItem);\r\n    }\r\n    let i = _sharedGroupList.length;\r\n    while (i--) {\r\n        let groupInfo = _sharedGroupList[i];\r\n        // 删除过期记录\r\n        if (!self.isToday(groupInfo.timestamp)) {\r\n            console.log('timestamp Invalid, not today:', groupInfo.timestamp);\r\n            _sharedGroupList.splice(i, 1);\r\n        }\r\n    }\r\n    config.shareGroupTime = _sharedGroupList.length;\r\n    console.log(\"config.shareGroupTime\",config.shareGroupTime,_sharedGroupList)\r\n  }\r\n  _setStorage(){\r\n    let groupInfo = {\r\n      timestamp: new Date().getTime()\r\n    }\r\n    let _sharedGroupList;\r\n    let sharedGroupListItem = cc.sys.localStorage.getItem('sharedGroupList');\r\n    if (!sharedGroupListItem) {\r\n        sharedGroupListItem = new Array();\r\n        cc.sys.localStorage.setItem('sharedGroupList', JSON.stringify(sharedGroupListItem));\r\n\r\n        _sharedGroupList = sharedGroupListItem;\r\n    } else {\r\n        _sharedGroupList = JSON.parse(sharedGroupListItem);\r\n    }\r\n    _sharedGroupList.push(groupInfo);\r\n\r\n    config.shareGroupTime = _sharedGroupList.length;\r\n    console.log('config.shareGroupTime,  today:', config.shareGroupTime);\r\n    cc.sys.localStorage.setItem('sharedGroupList', JSON.stringify(_sharedGroupList));\r\n  }\r\n  isToday (time) {\r\n    return new Date(time).toDateString() === new Date().toDateString();\r\n  }\r\n  _getImgUrl(index){  \r\n    return self._url[index].url;\r\n  }\r\n  // getShareTicket(){\r\n  //   return this.shareTicket\r\n  // };\r\n// 转发后； 点击 转发的卡片 会得到一个shareTicket 通过调用 wx.getShareInfo() 接口传入 shareTicket 可以获取群相关信\r\n updateShareMenu = function(){\r\n  console.log(\"updateShareMenu\")\r\n  if (cc.sys.platform == cc.sys.WECHAT_GAME){\r\n    wx.updateShareMenu({\r\n      withShareTicket: true,\r\n      success: function(res) {\r\n        console.log(\"updateShareMenu true res:\",res)\r\n      },\r\n      fail: function(res) \r\n      {\r\n        console.log(\"updateShareMenu fail res:\",res)\r\n      },\r\n      complete: function(res) {},\r\n    })\r\n  }\r\n}; \r\n//  右上角可以点击转发按钮\r\nshowShareMenu = function(){\r\n  console.log(\"showShareMenu\")\r\n  if (cc.sys.platform == cc.sys.WECHAT_GAME){\r\n    wx.showShareMenu({\r\n      withShareTicket: true,\r\n      success: function(res) {\r\n        console.log(\"showShareMenu true res:\",res)\r\n      },\r\n      fail: function(res) \r\n      {\r\n        console.log(\"showShareMenu fail res:\",res)\r\n      },\r\n      complete: function(res) {},\r\n    })\r\n  }\r\n}; \r\n onShareAppMessage = function(){\r\n  if (cc.sys.platform == cc.sys.WECHAT_GAME){ \r\n    wx.onShareAppMessage(function (res) {\r\n      // 用户点击了“转发”按钮\r\n      var _index = Math.random() > 0.5 ? 1 : 0;\r\n      var _title = 0;\r\n      var _titleIndex = (Math.floor(Math.random()*10)) % config.shareTitles['1'].length;\r\n      _title = config.shareTitles['1'][_titleIndex].title;   \r\n      return  {\r\n        title :_title,\r\n        imageUrl:self._getImgUrl(_index),\r\n        query:\"uid=\"+config.UID,\r\n        success:res=>{\r\n          console.log(\"onShareAppMessage success\",res,self,this)\r\n          if (res.shareTickets) {\r\n            if (res.shareTickets && res.shareTickets[0] && self ){\r\n              if(config.gamecenter_link){\r\n                self.getShareInfo(res.shareTickets[0],self.shareGroup); \r\n              }\r\n            }\r\n          }\r\n        },\r\n        fail:res=>{\r\n          console.log(res)\r\n        }\r\n      }\r\n    })\r\n  }\r\n};\r\n  //分享群\r\n shareGroup = function(groupid){\r\n    var url = urls.user +\"/add_group\";\r\n    var param = {\r\n        groupid: groupid,\r\n      };\r\n    util.request({\r\n        url: url,\r\n        data: param,\r\n        header: { 'content-type': 'application/x-www-form-urlencoded' },\r\n        method: 'POST',\r\n        success:res=>{\r\n            var d = res.data;\r\n        },\r\n        fail: function (er) {\r\n            console.error(er);\r\n          }\r\n    })      \r\n};\r\n getShareOpenGid = function(res,callBack){\r\n    var url = urls.share +\"/getShareInfo\";\r\n    var param = {\r\n      sessionKey:config.sessionkey,\r\n      encryptedData:res.encryptedData,\r\n      iv:res.iv,\r\n    }\r\n    util.request({\r\n        url: url,\r\n        data: param,\r\n        header: { 'content-type': 'application/x-www-form-urlencoded' },\r\n        method: 'POST',\r\n        success:res=>{\r\n            //服务器存储的用户数据\r\n            console.log(\"send getShareInfo \",res)\r\n            if(res.data && res.data.data && res.data.data.openGId){\r\n              //保存群的openGID;\r\n              config.groupOpenGID = res.data.data.openGId;\r\n              if (callBack && typeof callBack == 'function') callBack(res.data.data.openGId)\r\n            }\r\n            \r\n        },\r\n        fail:res=>{\r\n          console.log(\"send getShareInfo fail \",res)\r\n        },\r\n    })   \r\n };\r\n\r\n getShareOpenGidLocal = function(res, callBack) {\r\n  util.decodeOpenId(res, function (openid) {\r\n    if (openid && callBack && typeof callBack == 'function') {\r\n      callBack(openid);\r\n    }\r\n  });\r\n };\r\n\r\n getShareInfo = function(_shareTicket,callBack){\r\n  wx.getShareInfo({\r\n    shareTicket:_shareTicket,\r\n    success:res=>{\r\n      //保存shareTicket\r\n      config.shareTicket = _shareTicket;\r\n      if(config.gamecenter_link){\r\n        this.getShareOpenGid(res,callBack);\r\n      }else{\r\n        // 解密拿到群openid后保存到本地    \r\n        this.getShareOpenGidLocal(res, function (gopenid) {\r\n          console.log('get group open id:', gopenid);\r\n          shareUtil.setShareGroupInfo(gopenid);\r\n        })\r\n      }\r\n  \r\n    },\r\n    fail:res=>{\r\n      console.log('getShareInfo fail',res)\r\n    }\r\n  });\r\n};\r\n shareAppMessage = function(callBack,score = false,isSpecial =false,obj = false,isPeople = false,wxAddLayer =false,gold =false,isAssit =false){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit)\r\n};\r\n\r\nshareAppMessageWithRevived =function(callBack,score = false,isSpecial =false,obj = false,isPeople = false,wxAddLayer =false,gold =false,isAssit = false){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit,true);\r\n}\r\n\r\nshareAppMessageWithAssit = function(callBack,score = false,isSpecial =false,obj = false,isPeople = false,wxAddLayer =false,gold =false,isAssit = true){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit)\r\n}\r\n/**\r\n *  share 炫耀成绩获得金币\r\n * \r\n */\r\nshareAppMessageWithGold = function(callBack, score, gold ,wxAddLayer,isSpecial =false,obj = false,isPeople = false,isAssit =false){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit)\r\n};\r\n/**\r\n *  share 个人/群\r\n * \r\n */\r\nshareAppMessageWithImgUrl = function(callBack,score = false,isSpecial =false,obj = false,isPeople = true,wxAddLayer =false,gold =false,isAssit =false){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit)\r\n};\r\n/**\r\n * share 分享给群\r\n */\r\nshareAppMessageForGroup= function(callBack,score = false,isSpecial =false,obj = false,isPeople = false,wxAddLayer =false,gold =false,isAssit =false){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit)\r\n};\r\n/**\r\n * 分享 特殊功能\r\n */\r\nshareAppMessageWithSpecial = function(callBack,obj,score = false,isSpecial =true,isPeople = false,wxAddLayer =false ,gold =false,isAssit =false){\r\n  self._shareAppMessage(callBack,score,isSpecial,obj,isPeople,gold,wxAddLayer,isAssit)\r\n  console.log(\"shareAppMessageWithSpecial\",)\r\n};\r\n\r\n_shareAppMessage(callBack = false,score = false,isSpecial= false,obj= false,isPeople= false,gold= false,wxAddLayer = false,isAssit = false,isRevive = false){\r\n  console.log(\"_shareAppMessage\",callBack,score,isSpecial,isPeople,gold,wxAddLayer,isAssit,isRevive)\r\n\r\n  var _index = Math.random() > 0.5 ? 1 : 0;\r\n  var _title = 0;\r\n  if(typeof score == 'number'){\r\n    var _titleIndex = (Math.floor(Math.random()*10)) % config.shareTitles['2'].length;\r\n    _title = config.shareTitles['2'][_titleIndex].title;\r\n    _title = globalFunc.getTextext({title:_title,score:score})\r\n  }else{\r\n    var _titleIndex = (Math.floor(Math.random()*10)) % config.shareTitles['1'].length;\r\n    _title = config.shareTitles['1'][_titleIndex].title;   \r\n  }\r\n  var randString = null;\r\n  if(isAssit || isRevive ){\r\n    randString = util.randomString();\r\n    var _titleIndex = (Math.floor(Math.random()*10)) % config.shareTitles['3'].length;\r\n    _title = config.shareTitles['3'][_titleIndex].title;   \r\n  }\r\n  wx.shareAppMessage( {\r\n    title: _title,\r\n    imageUrl:self._getImgUrl(_index),\r\n    query: isAssit ? \"randStr=\" + randString + \"&uid=\"+config.UID : \"uid=\"+config.UID,\r\n    success:res=>{\r\n      console.log(\"wx.shareAppMessage\",res);\r\n      var shareHasCallBack = false;\r\n      if(!!!config.gamecenter_link){\r\n        if(isSpecial){\r\n          self._setStorage();\r\n          if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n            shareHasCallBack =true\r\n            callBack.call(obj);\r\n          } \r\n        }\r\n        if(gold){\r\n          let shareWithGold = false;\r\n          //let times = global.getStartGameTimes();\r\n          //console.log(times,wxAddLayer._isShareWithGold);\r\n          //if(times > config.startGameTimes){\r\n              // 已获得一次金币,其他不获取\r\n              if(wxAddLayer._isShareWithGold){\r\n                  let isShareGold = Math.floor(Math.random()*10) % 3;       \r\n                  if(isShareGold === 1){\r\n                    consume.addGold(gold);\r\n                    wxAddLayer._isShareWithGold = false;\r\n                    shareWithGold = true;\r\n                  };\r\n              }\r\n          //}\r\n          if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n            shareHasCallBack =true\r\n            callBack.call(obj,shareWithGold);\r\n          } \r\n        }\r\n      }\r\n      if(isAssit){\r\n        global.addRandString(randString);\r\n        if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n          shareHasCallBack =true\r\n          callBack.call(obj);\r\n        } \r\n      }\r\n      if(isRevive){\r\n        global.addRandString(randString);\r\n        if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n          shareHasCallBack =true\r\n          callBack.call(obj);\r\n        }      \r\n      }\r\n      var isGroup = false;\r\n      if (res.shareTickets && res.shareTickets[0]){\r\n        if(config.gamecenter_link){\r\n          this.getShareInfo(res.shareTickets[0],this.shareGroup);\r\n        }\r\n        //保存shareTicket\r\n        config.shareTicket = res.shareTickets[0];\r\n        if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n            shareHasCallBack =  true;\r\n            isGroup = true;\r\n            callBack.call(obj,isGroup);\r\n        } \r\n      };\r\n    \r\n      if(isPeople){\r\n        //console.log(\"getShareInfo\",isSpecial)\r\n        if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n          shareHasCallBack =  true\r\n          callBack.call(obj);\r\n        } \r\n      }else{\r\n        if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n          shareHasCallBack =  true\r\n          callBack.call(obj,isGroup);\r\n        } \r\n      }\r\n      if(score){\r\n        if(!!!shareHasCallBack && callBack && typeof callBack == \"function\"){\r\n          shareHasCallBack =  true\r\n          callBack.call(obj);\r\n        }     \r\n      }\r\n      \r\n    },\r\n    fail:res=>{\r\n      console.log(\"shareAppMessage fail\",res)\r\n    }\r\n  });\r\n};\r\n addFriend = function(_appID){\r\n  var url = urls.user +\"/add_friend\"\r\n  var param = {\r\n    frienduid :_appID,\r\n  }//config.getParam();\r\n  util.request({\r\n      url: url,\r\n      data: param,\r\n      header: { 'content-type': 'application/x-www-form-urlencoded' },\r\n      method: 'POST',\r\n      success:res=>{\r\n          console.log(\"addFriend Success\")\r\n      }\r\n  })\r\n};\r\n\r\n};\r\n\r\n\r\n\r\n// // 转发后； 点击 转发的卡片 会得到一个shareTicket 通过调用 wx.getShareInfo() 接口传入 shareTicket 可以获取群相关信\r\n// const  updateShareMenu = function(){\r\n//   console.log(\"updateShareMenu\")\r\n//   if (cc.sys.platform == cc.sys.WECHAT_GAME){\r\n//     wx.updateShareMenu({\r\n//       withShareTicket: true,\r\n//       success: function(res) {\r\n//         console.log(\"updateShareMenu true res:\",res)\r\n//       },\r\n//       fail: function(res) \r\n//       {\r\n//         console.log(\"updateShareMenu fail res:\",res)\r\n//       },\r\n//       complete: function(res) {},\r\n//     })\r\n//   }\r\n// }(); \r\n// const  showShareMenu = function(){\r\n//   console.log(\"showShareMenu\")\r\n//   if (cc.sys.platform == cc.sys.WECHAT_GAME){\r\n//     wx.showShareMenu({\r\n//       withShareTicket: true,\r\n//       success: function(res) {\r\n//         console.log(\"showShareMenu true res:\",res)\r\n//       },\r\n//       fail: function(res) \r\n//       {\r\n//         console.log(\"showShareMenu fail res:\",res)\r\n//       },\r\n//       complete: function(res) {},\r\n//     })\r\n//   }\r\n// }(); \r\n// const onShareAppMessage = function(){\r\n//   if (cc.sys.platform == cc.sys.WECHAT_GAME){ \r\n//     console.log(\"onShareAppMessage\")\r\n//     wx.onShareAppMessage(function (res) {\r\n//       console.log(\"onShareAppMessage\",res)\r\n//       // 用户点击了“转发”按钮\r\n//       return  {\r\n//         //title: '转发标题',\r\n//         imageUrl: canvas.toTempFilePathSync({\r\n//           destWidth: 500,\r\n//           destHeight: 400\r\n//         }),\r\n//         query:{\r\n//           key1:123456,\r\n    \r\n//         },\r\n//         success:res=>{\r\n\r\n//         if (res.shareTickets) {\r\n//             wx.getShareInfo({\r\n//               // 请问这里的shareTickets为什么是数组类型，并不允许或出现一次转发多个群组的情况啊\r\n//               // 如果是有其他使用情况，还请做说明，指点指点，谢谢。\r\n//               shareTicket: res.shareTickets[0],\r\n//               success:er=>{\r\n//                 console.log(er)\r\n//               },\r\n//               fail() { }\r\n//             })\r\n//           }\r\n//         },\r\n//         fail:res=>{\r\n//           console.log(res)\r\n//         }\r\n//       }\r\n//     })\r\n//   }\r\n// }();\r\n//   //分享群\r\n// const shareGroup = function(groupid){\r\n//     var url = urls.user +\"/add_group\";\r\n//     var param = {\r\n//         groupid: groupid,\r\n//       };\r\n//     util.request({\r\n//         url: url,\r\n//         data: param,\r\n//         header: { 'content-type': 'application/x-www-form-urlencoded' },\r\n//         method: 'POST',\r\n//         success:res=>{\r\n//             console.log(\"add_group Success\")\r\n//             var d = res.data;\r\n//             console.log(d);\r\n//         },\r\n//         fail: function (er) {\r\n//             console.error(er);\r\n//           }\r\n//     })      \r\n// };\r\n// const getShareInfo = function(res,callBack){\r\n//   wx.getShareInfo({\r\n//     shareTicket:res.shareTickets[0],\r\n//     success:res=>{\r\n//       var url = urls.share +\"/getShareInfo\";\r\n//       var param = {\r\n//         sessionKey:config.sessionkey,\r\n//         encryptedData:res.encryptedData,\r\n//         iv:res.iv,\r\n//       }\r\n//       util.request({\r\n//           url: url,\r\n//           data: param,\r\n//           header: { 'content-type': 'application/x-www-form-urlencoded' },\r\n//           method: 'POST',\r\n//           success:res=>{\r\n//               //服务器存储的用户数据\r\n//               console.log(\"send getShareInfo \",res)\r\n//               if (callBack && typeof callBack == 'function') callBack(res.data.data.openGId)\r\n//           },\r\n//           fail:res=>{\r\n\r\n//           },\r\n//       })            \r\n//     },\r\n//     fail:res=>{\r\n//       console.log('getShareInfo fail',res)\r\n//     }\r\n//   });\r\n// };\r\n// const shareAppMessage = function(uid){\r\n//   uid = config.UID;\r\n//   console.log(\"shareAppMessage\",uid)\r\n//   wx.shareAppMessage( {\r\n//     title: '转发标题',\r\n//     imageUrl: canvas.toTempFilePathSync({\r\n//       destWidth: 500,\r\n//       destHeight: 400\r\n//     }),\r\n//     query:{\r\n//       uid: uid ,\r\n//     },\r\n//     success:res=>{\r\n//       console.log(\"shareAppMessage\",res);\r\n//       if (res.shareTickets && res.shareTickets[0]){\r\n//         console.log('shareAppMessage getShareInfo')\r\n//         getShareInfo(res,shareGroup); \r\n//       }\r\n      \r\n//     },\r\n//     fail:res=>{\r\n//       console.log(\"shareAppMessage fail\",res)\r\n//     }\r\n//   });\r\n// };\r\n// const addFriend = function(_appID){\r\n//   var url = urls.user +\"/add_friend\"\r\n//   var param = {\r\n//     appid :_appID,\r\n//     frienduid :\"chen\",\r\n//   }//config.getParam();\r\n//   util.request({\r\n//       url: url,\r\n//       data: param,\r\n//       header: { 'content-type': 'application/x-www-form-urlencoded' },\r\n//       method: 'POST',\r\n//       success:res=>{\r\n//           console.log(\"addFriend Success\")\r\n//       }\r\n//   })\r\n// };\r\n\r\n\r\n// module.exports = {  \r\n//   shareAppMessage: shareAppMessage,\r\n//   getShareInfo: getShareInfo,\r\n//   addFriend: addFriend,\r\n//   shareGroup:shareGroup,\r\n// }"]}